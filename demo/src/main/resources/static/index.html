<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Tristan's Bank</title>
</head>

<body class="font-sans flex items-center justify-center bg-white">
  <div class="w-full max-w-4xl mx-auto p-8 shadow-2xl rounded-xl">
    <!-- Hoofd Titel -->
    <h1 class="text-4xl font-extrabold text-center text-green-600 mb-6">Tristan's Bank</h1>

    <!-- Bank Balans -->
    <div id="balance" class="text-2xl font-semibold text-gray-700 mt-4 mb-6">Balance: €0</div>

    <!-- Deposit/Withdraw Functionaliteit -->
    <div class="space-y-4">
      <input id="amount" type="number" placeholder="Enter an amount"
        class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">

      <button onclick="deposit()"
        class="w-full bg-gradient-to-r from-green-400 via-green-500 to-green-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-green-700 transition duration-200 ease-in-out transform hover:scale-105 deposit-button">
        Deposit
      </button>

      <button onclick="withdraw()"
        class="w-full bg-gradient-to-r from-red-400 via-red-500 to-red-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-red-700 transition duration-200 ease-in-out transform hover:scale-105 withdraw-button">
        Withdraw
      </button>
    </div>

    <!-- Transactie Geschiedenis -->
    <div class="mt-8">
      <h2 class="text-xl font-bold text-gray-700 mb-4">Transaction History</h2>
      <table class="w-full text-left border-collapse">
        <thead>
          <tr>
            <th class="border-b-2 border-gray-300 py-2">Type</th>
            <th class="border-b-2 border-gray-300 py-2">Amount</th>
            <th class="border-b-2 border-gray-300 py-2">Date</th>
          </tr>
        </thead>
        <tbody id="transaction-history">
          <!-- Transacties worden hier dynamisch toegevoegd -->
        </tbody>
      </table>
    </div>

    <!-- Crypto Functionaliteit -->
    <div class="mt-8">
      <h2 class="text-xl font-bold text-gray-700 mb-4">Crypto Wallet</h2>

      <!-- Live Prijzen -->
      <div class="mb-4">
        <h3 class="text-lg font-bold text-gray-700">Live Crypto Prices:</h3>
        <ul id="crypto-prices" class="list-disc pl-5 text-gray-700">
          <li>BTC: Loading...</li>
          <li>ETH: Loading...</li>
        </ul>
      </div>

      <!-- Crypto Wallet -->
      <div class="mb-4">
        <h3 class="text-lg font-bold text-gray-700">Your Crypto Balances:</h3>
        <ul id="crypto-balances" class="list-disc pl-5 text-gray-700">
          <li>BTC: 0</li>
          <li>ETH: 0</li>
        </ul>
      </div>

      <!-- Koop Crypto -->
      <h3 class="text-xl font-bold text-gray-700 mb-4">Buy Crypto</h3>
      <label for="crypto-withdraw-select" class="block text-md font-medium text-gray-700">Select Crypto to buy</label>
      <select id="crypto-select" class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl mb-2">
        <option value="BTC">Buy BTC</option>
        <option value="ETH">Buy ETH</option>
      </select>
      <label for="crypto-withdraw-amount" class="block text-md font-medium text-gray-700">Amount</label>
      <input id="crypto-amount" type="number" placeholder="Enter amount in €"
        class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
      <button onclick="buyCrypto()"
        class="w-full bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition duration-200 ease-in-out transform hover:scale-105 mt-4">
        Buy Crypto
      </button>
    </div>

    <div class="mt-8">
      <h3 class="text-xl font-bold text-gray-700 mb-4">Withdraw Crypto</h3>
      <div class="space-y-4">
        <div>
          <label for="crypto-withdraw-select" class="block text-md font-medium text-gray-700">Select Crypto to
            withdraw</label>
          <select id="crypto-withdraw-select"
            class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
            <option value="BTC">Withdraw BTC</option>
            <option value="ETH">Withdraw ETH</option>
          </select>
        </div>
        <div>
          <label for="crypto-withdraw-amount" class="block text-md font-medium text-gray-700">Amount</label>
          <input id="crypto-withdraw-amount" type="number" step="0.000001"
            class="w-full p-4 border-2 border-gray-300 rounded-lg text-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
            placeholder="Amount to withdraw">
        </div>
        <button onclick="withdrawCrypto()"
          class="w-full bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-blue-700 transition duration-200 ease-in-out transform hover:scale-105 mt-4">Withdraw</button>
      </div>
    </div>


    <!-- Crypto Grafiek -->
    <div class="mt-8">
      <h3 class="text-xl font-bold text-gray-700 mb-4">Crypto Price Chart</h3>
      <div class="flex space-x-4">
        <div class="w-1/2">
          <canvas id="btcChart" class="h-96"></canvas> <!-- Verhoogde hoogte van de BTC grafiek -->
        </div>
        <div class="w-1/2">
          <canvas id="ethChart" class="h-96"></canvas> <!-- Verhoogde hoogte van de ETH grafiek -->
        </div>
      </div>
    </div>


  </div>

  </div>

  <script>
    const cryptoApiUrl = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=eur";

    const wallet = {
      balance: 1000, // Startwaarde in euro
      crypto: {
        BTC: 0,
        ETH: 0,
      },
    };

    let btcChart; // De BTC grafiek
    let ethChart; // De ETH grafiek

    // Haal de grafiekdata op uit localStorage of initialiseert als het nog niet bestaat
    function loadChartData() {
      const savedData = localStorage.getItem("chartData");
      if (savedData) {
        return JSON.parse(savedData);
      }
      return {
        labels: [],
        btcData: [],
        ethData: [],
      };
    }

    // Bewaar de grafiekdata in localStorage
    function saveChartData(chartData) {
      localStorage.setItem("chartData", JSON.stringify(chartData));
    }

    // Initialiseer de grafieken
    function initCharts(chartData) {
      const btcCtx = document.getElementById('btcChart').getContext('2d');
      btcChart = new Chart(btcCtx, {
        type: 'line',
        data: {
          labels: chartData.labels,
          datasets: [{
            label: 'BTC Price (€)',
            borderColor: '#F2A900',
            data: chartData.btcData,
            fill: false,
            borderWidth: 2,
          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Time'
              }
            },
            y: {
              title: {
                display: true,
                text: 'BTC Price (€)'
              },
              min: 89000, // Minimum waarde voor BTC
              max: 93000, // Maximum waarde voor BTC
              beginAtZero: false
            }
          }
        }
      });

      const ethCtx = document.getElementById('ethChart').getContext('2d');
      ethChart = new Chart(ethCtx, {
        type: 'line',
        data: {
          labels: chartData.labels,
          datasets: [{
            label: 'ETH Price (€)',
            borderColor: '#4CAF50',
            data: chartData.ethData,
            fill: false,
            borderWidth: 2,
          }],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Time'
              }
            },
            y: {
              title: {
                display: true,
                text: 'ETH Price (€)'
              },
              min: 3000, // Minimum waarde voor ETH
              max: 3300, // Maximum waarde voor ETH
              beginAtZero: false
            }
          }
        }
      });
    }

    // Update de grafiek met de nieuwe prijzen
    async function updateChart(prices, chartData) {
      const currentTime = new Date();
      const timeLabel = currentTime.toLocaleTimeString();

      // Voeg nieuwe tijdstempel toe aan de labels en prijzen aan de datasets
      if (chartData.labels.length >= 60) { // Houdt maximaal 60 gegevenspunten bij (1 per minuut)
        chartData.labels.shift(); // Verwijder het oudste tijdstip
        chartData.btcData.shift(); // Verwijder de oudste BTC-prijs
        chartData.ethData.shift(); // Verwijder de oudste ETH-prijs
      }

      chartData.labels.push(timeLabel); // Voeg het nieuwe tijdstip toe
      chartData.btcData.push(prices.BTC); // Voeg de nieuwe BTC-prijs toe
      chartData.ethData.push(prices.ETH); // Voeg de nieuwe ETH-prijs toe

      // Bewaar de bijgewerkte grafiekdata
      saveChartData(chartData);

      // Update de grafieken
      btcChart.update();
      ethChart.update();
    }

    // Haal de crypto-prijzen op en update de grafiek
    async function fetchCryptoPrices(chartData) {
      const response = await fetch(cryptoApiUrl);
      const data = await response.json();
      const prices = {
        BTC: data.bitcoin.eur,
        ETH: data.ethereum.eur,
      };


      if (prices && prices.BTC && prices.ETH) {
        document.getElementById("crypto-prices").innerHTML = `
    <li><img src="images/btc.png" alt="BTC Logo" class="inline-block w-6 h-6"> BTC: €${prices.BTC}</li>
    <li><img src="images/eth.png" alt="ETH Logo" class="inline-block w-6 h-6"> ETH: €${prices.ETH}</li>
  `;
      } else {
        console.error("Error: Prices not available");
      }

      //     document.getElementById("crypto-prices").innerHTML = `
      // <li><img src="./demo/images/btc.png" alt="BTC Logo" class="inline-block w-6 h-6"> BTC: €${prices.BTC}</li>
      // <li><img src="./demo/images/eth.png" alt="ETH Logo" class="inline-block w-6 h-6"> ETH: €${prices.ETH}</li>
      //     `;

      // Update de grafiek met de nieuwe prijzen
      updateChart(prices, chartData);

      return prices;
    }

    // Laad wallet vanuit localStorage
    function loadWallet() {
      const savedWallet = localStorage.getItem("wallet");
      if (savedWallet) {
        Object.assign(wallet, JSON.parse(savedWallet));
      }
      updateUI();
    }

    // Sla wallet op in localStorage
    function saveWallet() {
      localStorage.setItem("wallet", JSON.stringify(wallet));
    }

    // Update UI
    function updateUI() {
      document.getElementById("balance").innerText = `Balance: €${wallet.balance.toFixed(2)}`;
      const cryptoList = document.getElementById("crypto-balances");
      cryptoList.innerHTML = `
        <li>BTC: ${wallet.crypto.BTC.toFixed(6)}</li>
        <li>ETH: ${wallet.crypto.ETH.toFixed(6)}</li>
      `;
    }

    // Deposit functie
    function deposit() {
      const amount = parseFloat(document.getElementById("amount").value);
      if (amount > 0) {
        wallet.balance += amount;
        saveWallet();
        updateUI();
        addTransaction("Deposit", amount);

        // Reset het input veld na een succesvolle deposit
        document.getElementById("amount").value = "";
      } else {
        alert("Enter a valid amount.");
      }
    }


    // Withdraw functie
    function withdraw() {
      const amount = parseFloat(document.getElementById("amount").value);
      if (amount > 0 && wallet.balance >= amount) {
        wallet.balance -= amount;
        saveWallet();
        updateUI();
        addTransaction("Withdraw", amount);

        // Reset het input veld na een succesvolle withdraw
        document.getElementById("amount").value = "";
      } else {
        alert("Invalid amount or insufficient balance.");
      }
    }


    // Voeg transactie toe
    function addTransaction(type, amount) {
      const date = new Date().toLocaleString();
      const table = document.getElementById("transaction-history");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="border-b border-gray-300 py-2">${type}</td>
        <td class="border-b border-gray-300 py-2">€${amount}</td>
        <td class="border-b border-gray-300 py-2">${date}</td>
      `;
      table.appendChild(row);
    }

    // Crypto kopen
    async function buyCrypto() {
      const amount = parseFloat(document.getElementById("crypto-amount").value);
      const selectedCrypto = document.getElementById("crypto-select").value;

      if (amount > 0 && wallet.balance >= amount) {
        const prices = await fetchCryptoPrices();
        const cryptoPrice = prices[selectedCrypto];

        const cryptoAmount = amount / cryptoPrice;
        wallet.crypto[selectedCrypto] += cryptoAmount;
        wallet.balance -= amount;

        saveWallet();
        updateUI();
        addTransaction(`Buy ${selectedCrypto}`, amount);

        // Reset de invoervelden na de transactie
        document.getElementById("crypto-amount").value = "";
        document.getElementById("crypto-select").value = "BTC"; // Of stel een standaard waarde in zoals BTC
      } else {
        alert("Invalid amount or insufficient balance.");
      }
    }


    // Laad de gegevens en initialiseer alles
    window.onload = () => {
      const chartData = loadChartData();
      loadWallet();
      initCharts(chartData);
      fetchCryptoPrices(chartData);
      setInterval(() => fetchCryptoPrices(chartData), 60000); // Refresh de prijzen elke minuut
    };

    // Withdraw Crypto functie
    async function withdrawCrypto() {
      const amount = parseFloat(document.getElementById("crypto-withdraw-amount").value);
      const selectedCrypto = document.getElementById("crypto-withdraw-select").value;

      if (amount > 0 && wallet.crypto[selectedCrypto] >= amount) {
        // Verminder de hoeveelheid van de crypto in de wallet
        wallet.crypto[selectedCrypto] -= amount;
        wallet.balance += amount * (await getCryptoPrice(selectedCrypto)); // Bereken de waarde van de crypto in EUR en voeg deze toe aan de balans

        saveWallet();
        updateUI();
        addTransaction(`Withdraw ${selectedCrypto}`, amount);

        // Reset de invoervelden na de transactie
        document.getElementById("crypto-withdraw-amount").value = "";
        document.getElementById("crypto-withdraw-select").value = "BTC"; // Of stel een standaard waarde in zoals BTC
      } else {
        alert("Invalid amount or insufficient balance.");
      }
    }


    // Haal de prijs op van de geselecteerde crypto (BTC of ETH)
    async function getCryptoPrice(crypto) {
      const prices = await fetchCryptoPrices();
      return prices[crypto];
    }

  </script>


</body>

</html>